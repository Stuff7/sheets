(()=>{var ct=[];function W(t){let e=o=>{nt(n),ct.push(n);try{t(o)}finally{ct.pop()}},n={execute:e,dependencies:new Set};return e(void 0),n}function Ee(t,e){let n=r=>{nt(o),t.forEach(s=>{ve(o,s.listeners)});try{e(r)}finally{ct.pop()}},o={execute:n,dependencies:new Set};return n(void 0),o}function N(t,e){let n=r=>{nt(o),ct.push(o);try{t()}finally{ct.pop()}try{e(r)}finally{ct.pop()}},o={execute:n,dependencies:new Set};return n(void 0),o}function T(t=void 0){let e=new Set,n=t,o=()=>{let s=ct[ct.length-1];return s&&ve(s,e),n},r=s=>{let i=n;n=s;for(let a of[...e])a.execute(i)};return[Object.assign(o,{listeners:e}),Object.assign(r,{byRef:s=>{s(n),r(n)},byRefAsync:async s=>{await s(n),r(n)}})]}function dt(t){let e=t;Object.defineProperty(e,"listeners",{value:new Set,enumerable:!1,configurable:!0});for(let n in e){let o=e[n];Object.defineProperty(e,n,{get:()=>{let r=ct[ct.length-1];return r&&ve(r,e.listeners),o},set:r=>{let s=o;o=r;for(let i of[...e.listeners])i.execute(s)}})}return e}function Bt(t){return"listeners"in t&&t.listeners instanceof Set}function ve(t,e){e.add(t),t.dependencies.add(e)}function nt(t){for(let e of t.dependencies)e.delete(t);t.dependencies.clear()}function Se(t,e){t[e]=t[t.length-1],t.length--}function je(t,e){e(t);for(let n of t.childNodes)je(n,e);t.remove()}function Ze(t){let e={parent:null,prevSibling:null,nextSibling:null,setFromElement(n){this.parent=n.parentElement,this.prevSibling=n.previousSibling,this.nextSibling=n.nextSibling},isPositioned(){return!!(this.parent||this.prevSibling||this.nextSibling)},getInsertFunction(){if(this.prevSibling&&this.prevSibling.parentElement)return this.prevSibling.after.bind(this.prevSibling);if(this.nextSibling&&this.nextSibling.parentElement)return this.nextSibling.before.bind(this.nextSibling);if(this.parent)return this.nextSibling?this.parent.prepend.bind(this.parent):this.parent.append.bind(this.parent);throw new Error("Could not find element position")},insertNode(...n){try{return this.getInsertFunction()(...n),!0}catch{return!1}}};return t&&queueMicrotask(()=>e.setFromElement(t)),e}function E(t){let e=/<select|<ul|<table/i.test(t)&&/<slot/i.test(t);function n(s){if(s.nodeType===Node.TEXT_NODE)return document.createTextNode(s.nodeValue);if(s.nodeType===Node.ELEMENT_NODE){let i=document.createElement(s.localName);for(let{name:a,value:u}of Array.from(s.attributes))i.setAttribute(a,u);for(let a of Array.from(s.childNodes))i.appendChild(n(a));return i}return document.createDocumentFragment()}function o(){if(e)try{let a=new DOMParser().parseFromString(`<root>${t}</root>`,"application/xml");if(a.getElementsByTagName("parsererror").length)throw new Error("XML parse failed");let u=a.documentElement.firstChild;return n(u)}catch{}let s=document.createElement("template");return s.innerHTML=t,s.content.firstChild}let r;return()=>(r||(r=o())).cloneNode(!0)}function Q(t){let e=[];return(t==="resize"||t==="hashchange"?window:document).addEventListener(t,n=>{for(let o=e.length-1;o>=0;o--){let r=e[o];r.target.isConnected&&(r.fn(n),r.once&&Se(e,o))}}),e}function At(t){je(t,e=>e.dispatchEvent(new CustomEvent("destroy")))}function P(t,e,n){let o=!1;n instanceof Array?n[0]&&(t.push({fn:n[0],once:n[1].once,target:e}),o=!0):n&&(t.push({fn:n,target:e}),o=!0),o&&e.addEventListener("destroy",()=>{let r=t.findIndex(s=>s.target===e);r!==-1&&Se(t,r)})}function v(t,e,n){n instanceof Array?t.addEventListener(e,n[0],n[1]):t.addEventListener(e,n)}function Ae(t,e){t instanceof Array?t.forEach(e):e(t)}function se(t,e,n){let o;t.addEventListener("destroy",()=>{o?Ae(o,At):nt(s)});let r=()=>(o=e(),Ae(o,i=>{i.addEventListener("destroy",()=>{nt(s),t.remove()})}),o),s=N(n,()=>{if(n()){let i=o||(o=r());i instanceof Array?t.replaceWith(...i):t.replaceWith(i)}else o&&Ae(o,i=>i.replaceWith(t))});return n()?o||(o=r()):t}function k(t,e,n){n==null||n===!1?t.removeAttribute(e):t.setAttribute(e,n)}function B(t,e,n){let o;e==="value"||e==="checked"?o=W(()=>{t[e]=n()}):o=W(()=>{k(t,e,n())}),t.addEventListener("destroy",()=>nt(o))}function q(t,e,n){let o=W(()=>{n()?t.classList.add(e):t.classList.remove(e)});t.addEventListener("destroy",()=>nt(o))}function L(t,e,n){if(typeof n=="function"){let o=W(()=>t.style.setProperty(e,n()));t.addEventListener("destroy",()=>nt(o))}else t.style.setProperty(e,n.toString())}function w(t,e){if(t instanceof HTMLSlotElement&&!e)return t.replaceWith(...t.childNodes),t.children;if(typeof e=="string"||typeof e=="number"){let n=document.createTextNode("");return n.textContent=e.toString(),t.replaceWith(n),n}else{if(e instanceof Node)return t.replaceWith(e),e;if(e instanceof Array){let n=t,o=t;for(let r=0;r<e.length;r++)r+1<e.length&&(n=document.createComment(""),o.after(n)),w(o,e[r]),o=n;return e}else{let n=document.createTextNode("");t.replaceWith(n);let o=W(()=>{let r=e();typeof r=="string"?n.textContent=r:r!=null?n.textContent=r.toString():r==null&&(n.textContent="")});return n.addEventListener("destroy",()=>nt(o)),n}}}function Je(t,e,n,o="jsx"){let r;t.addEventListener("destroy",()=>{r?At(r):nt(b)});let s=()=>`${o}-enter-active`,i=()=>`${o}-enter-from`,a=()=>`${o}-enter-to`,u=()=>`${o}-leave-active`,l=()=>`${o}-leave-from`,d=()=>`${o}-leave-to`;function c(){return new Promise(j=>{requestAnimationFrame(()=>requestAnimationFrame(j))})}let C=()=>(r=e(),r.addEventListener("destroy",()=>{nt(b),t.remove()}),r.addEventListener("transitionend",()=>{x(),n()||r.replaceWith(t)}),r),h=()=>r||(r=C()),S=!0,b=N(n,async()=>{if(S&&!n()){S=!1;return}if(S=!1,h().classList.length&&(!n()&&(h().classList.contains(i())||h().classList.contains(s())||h().classList.contains(a()))?(await c(),x(),h().replaceWith(t)):n()&&(h().classList.contains(l())||h().classList.contains(d())||h().classList.contains(u()))&&(await c(),x(),h().replaceWith(t))),n()){if(h().isConnected)return;h().classList.add(i()),h().classList.add(s()),t.replaceWith(h()),await c(),h().classList.remove(i()),h().classList.add(a())}else h().isConnected&&(h().classList.add(l()),h().classList.add(u()),await c(),h().classList.remove(l()),h().classList.add(d()))});function x(){h().classList.remove(s()),h().classList.remove(i()),h().classList.remove(a()),h().classList.remove(u()),h().classList.remove(l()),h().classList.remove(d())}return n()?h():t}var[Tt,mt]=en(26,65),[Lt,xt]=en(26,97);function Gt(t,e){return`${Tt(t)}${Lt(e)}`}function wt(t,e){return e*D+t}function lt(t,e,n){let o=0;for(let r in n){let s=+r;s<=e&&s>=t&&(o+=n[r])}return o}function Te(t){return Object.values(t).reduce((e,n)=>e+n,0)}var bt=navigator.maxTouchPoints>0,tn=(()=>{let t=navigator.userAgent,e=/Macintosh|iPad|iPhone/.test(t),n=/WebKit/.test(t)&&!/Chrome|CriOS|FxiOS|Edg|OPR/.test(t),o=typeof navigator.maxTouchPoints=="number"&&navigator.maxTouchPoints>0;return e&&n&&(o||/Safari/.test(t))})();function Le(t,e){return t+(e-1)&~(e-1)}function Ie(t,e){return Math.floor(t/e)*e}function en(t,e){return[n=>{let o=n+1,r="";for(;o>0;){let s=(o-1)%t;r=String.fromCharCode(e+s)+r,o=Math.floor((o-1)/t)}return r},n=>{let o=0;for(let r=0;r<n.length;r++)o=o*t+(n.charCodeAt(r)-e+1);return o-1}]}function pt(t){let e,n;if(t instanceof MouseEvent)e=t.clientX,n=t.clientY;else if(t instanceof TouchEvent){let o=t.touches[0]||t.changedTouches[0];if(!o)return{x:-1,y:-1};e=o.clientX,n=o.clientY}else return{x:-1,y:-1};return{x:e,y:n}}function Et(t){let e=t[0]==="#"?t.slice(1):t;(e.length===3||e.length===4)&&(e=e.split("").map(i=>i+i).join(""));let n=Number.parseInt(e.slice(0,2),16)/256,o=Number.parseInt(e.slice(2,4),16)/256,r=Number.parseInt(e.slice(4,6),16)/256,s=e.length===8?Number.parseInt(e.slice(6,8),16)/255:1;return[n,o,r,s]}var Oe=1,nn=[.25,.25,.27,1],on=[.89,.89,.91,1],rn=[.2,.83,.6,.4],sn=[.31,.27,.9,.6],Fe="#18181b",ke="#fafafa",ln=Et(Fe),an=Et(ke),_t="h-full min-w-px bg-zinc-400 dark:bg-zinc-700",D=9e4,It=2e5,G=99,V=33,zt="Roboto",Wt=16,Vt="",cn=!1,un=!1,fn=!1,dn=!1,ie="Number",De="[A-Za-z0-9_]",mn=new RegExp(De);var X={identity(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},ortho(t,e,n,o,r,s,i){i.fill(0);let a=1/(e-t),u=1/(o-n),l=-1/(s-r);i[0]=2*a,i[5]=2*u,i[10]=2*l,i[12]=-(e+t)*a,i[13]=-(o+n)*u,i[14]=-(s+r)*l,i[15]=1},mulAdds(t,e,n,o,r,s){s[0]+=t*r,s[1]+=e*r,s[2]+=n*r,s[3]+=o*r},translate(t,e,n,o){t[12]+=e,t[13]+=n,t[14]+=o},translatePx(t,e,n,o){return X.translate(t,e*t[0],n*t[5],o*t[10])},translateTo(t,e,n,o){t[12]=e,t[13]=n,t[14]=o},translatePxTo(t,e,n,o){return X.translateTo(t,e*t[0],n*t[5],o*t[10])},scaleIdentity(t,e,n,o){t[0]=e,t[5]=n,t[10]=o},scale(t,e,n,o){t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=o,t[9]*=o,t[10]*=o,t[11]*=o},toString(t,e=4,n=4,o=4){if(t.length!==e*n)throw new Error("Invalid matrix dimensions");let r=new Array(n).fill(0);for(let i=0;i<t.length;i++){let a=Math.floor(i/n),u=t[i].toFixed(o);r[a]=Math.max(r[a],u.length)}let s="";for(let i=0;i<n;i++){let a=Array.from({length:e},(u,l)=>t[l*n+i].toFixed(o).padStart(r[l])).join("  ");s+=`[ ${a} ]
`}return s.trim()}};var ot=25,Ht=4,Ot=ot*Ht;function xn(t,e){for(let n=0;n<e*ot;n+=ot)t.set(X.identity(),n),t.set([0,0,1,1],n+20)}function pn(t){let e=new Float32Array(t*ot);return xn(e,t),{data:e,len:t,resize(n){if(n===this.len)return!1;let o=n*ot;if(n<this.len)this.data=this.data.subarray(0,o);else{let r=new Float32Array(o);r.set(this.data),xn(r.subarray(this.data.length),n-this.len),this.data=r}return this.len=n,!0},modelAt(n){let o=n*ot;return this.data.subarray(o,o+16)},colorAt(n){let o=n*ot+16;return this.data.subarray(o,o+4)},uvAt(n){let o=n*ot+20;return this.data.subarray(o,o+4)},hasUVAt(n){let o=n*ot+24;return this.data.subarray(o,o+1)}}}var no=2,oo=4,hn=no*oo,Ue={vertexData:new Float32Array([0,0,1,0,1,1,0,1]),indexData:new Uint8Array([0,1,2,2,3,0])};function gn(t,e,n,o,r){let s={startCol:e,startRow:n,endCol:o,endRow:r},i=[...t].map(U);i.push(s);let a=le(i);t.clear();for(let u of a)t.add(Yt(u))}function bn(t,e,n,o,r){let s={startCol:e,startRow:n,endCol:o,endRow:r},i=[];for(let u of t){let l=U(u);at(l,s)?i.push(...Me(l,s)):i.push(l)}let a=le(i);t.clear();for(let u of a)t.add(Yt(u))}function Xt(t,e,n,o,r){let s={startCol:e,startRow:n,endCol:o,endRow:r},i=[...t].map(U),a=i.flatMap(C=>at(C,s)?Me(C,s):[C]),u=i.filter(C=>at(C,s)),l=le(u),d=[s];for(let C of l)d=d.flatMap(h=>at(h,C)?Me(h,C):[h]);let c=le([...a,...d]);t.clear();for(let C of c)t.add(Yt(C))}function ut(t){let e=lt(0,t.startCol-1,p().colOffsets()),n=lt(0,t.startRow-1,p().rowOffsets()),o=t.startCol*G+e,r=t.startRow*V+n,s=lt(0,t.endCol-1,p().colOffsets()),i=lt(0,t.endRow-1,p().rowOffsets()),a=t.endCol*G+s+Ft(t.endCol),u=t.endRow*V+i+kt(t.endRow);return[o,r,a-o,u-r]}function Yt(t){return`${t.startCol},${t.startRow}:${t.endCol},${t.endRow}`}function U(t){let[e,n]=t.split(":"),[o,r]=e.split(",").map(Number),[s,i]=n.split(",").map(Number);return{startCol:o,startRow:r,endCol:s,endRow:i}}function at(t,e){return t.startCol<=e.endCol&&t.endCol>=e.startCol&&t.startRow<=e.endRow&&t.endRow>=e.startRow}function Me(t,e){let n=[];e.startRow>t.startRow&&n.push({startCol:t.startCol,endCol:t.endCol,startRow:t.startRow,endRow:e.startRow-1}),e.endRow<t.endRow&&n.push({startCol:t.startCol,endCol:t.endCol,startRow:e.endRow+1,endRow:t.endRow});let o=Math.max(t.startRow,e.startRow),r=Math.min(t.endRow,e.endRow);return o<=r&&(e.startCol>t.startCol&&n.push({startCol:t.startCol,endCol:e.startCol-1,startRow:o,endRow:r}),e.endCol<t.endCol&&n.push({startCol:e.endCol+1,endCol:t.endCol,startRow:o,endRow:r})),n}function le(t){let e=t,n=!0,o=(s,i)=>({startCol:Math.min(s.startCol,i.startCol),startRow:Math.min(s.startRow,i.startRow),endCol:Math.max(s.endCol,i.endCol),endRow:Math.max(s.endRow,i.endRow)}),r=(s,i)=>at(s,i)||s.startRow===i.startRow&&s.endRow===i.endRow&&(s.endCol+1===i.startCol||i.endCol+1===s.startCol)||s.startCol===i.startCol&&s.endCol===i.endCol&&(s.endRow+1===i.startRow||i.endRow+1===s.startRow);for(;n;){n=!1;let s=[];for(;e.length>0;){let i=e.shift(),a=!1;for(let u=0;u<e.length;u++)if(r(i,e[u])){i=o(i,e[u]),e.splice(u,1),a=n=!0;break}s.push(i)}e=s}return e}var Ne=(l=>(l[l.Number=0]="Number",l[l.Identifier=1]="Identifier",l[l.Operator=2]="Operator",l[l.LParen=3]="LParen",l[l.RParen=4]="RParen",l[l.Colon=5]="Colon",l[l.Comma=6]="Comma",l[l.Bang=7]="Bang",l[l.EOF=8]="EOF",l))(Ne||{});function _n(t){let e=[],n=t[0]==="="?1:0;for(;n<t.length;){let o=t[n];if(/\s/.test(o)){n++;continue}if(/\d/.test(o)){let r=o;for(n++;n<t.length&&/[\d.]/.test(t[n]);)r+=t[n++];e.push({type:0,text:r});continue}if(/[A-Za-z]/.test(o)){let r=o;for(n++;n<t.length&&mn.test(t[n]);)r+=t[n++];e.push({type:1,text:r});continue}switch(o){case"+":case"-":case"*":case"/":e.push({type:2,text:o}),n++;break;case"(":e.push({type:3,text:o}),n++;break;case")":e.push({type:4,text:o}),n++;break;case":":e.push({type:5,text:o}),n++;break;case",":e.push({type:6,text:o}),n++;break;case"!":e.push({type:7,text:o}),n++;break;default:throw new Error(`Unexpected character: '${o}'`)}}return e.push({type:8,text:""}),e}var Cn={"+":10,"-":10,"*":20,"/":20},Dt=class{tokens;pos=0;constructor(e){this.tokens=_n(e)}peek(){return this.tokens[this.pos]}next(){return this.tokens[this.pos++]}parseExpression(e=0){let n=this.next(),o=this.nud(n);for(;e<this.lbp(this.peek());)n=this.next(),o=this.led(n,o);return o}nud(e){switch(e.type){case 0:return{type:"number",value:Number.parseFloat(e.text)};case 1:{if(this.peek().type===7){let n=e.text;this.next();let o=this.next();if(o.type!==1)throw new Error(`Expected cell ref after !, got ${o.text}`);let r=o.text;if(this.peek().type===5){this.next();let s=this.next();if(s.type!==1)throw new Error(`Invalid range end: ${s.text}`);return{type:"range",sheet:n,start:r,end:s.text}}return{type:"cell",sheet:n,id:r}}if(this.peek().type===3){let n=e.text;this.next();let o=[];if(this.peek().type!==4)do o.push(this.parseExpression());while(this.peek().type===6&&this.next());return this.expect(4),{type:"func",name:n,args:o}}return{type:"cell",id:e.text}}case 3:{let n=this.parseExpression();return this.expect(4),n}default:throw new Error(`Unexpected token in nud: ${e.text}`)}}led(e,n){switch(e.type){case 2:{let o=Cn[e.text]||0,r=this.parseExpression(o);return{type:"binary",op:e.text,left:n,right:r}}case 5:{let o=n.type==="cell"?n.id:(()=>{throw new Error("Invalid range start")})(),r=n.sheet,s=this.next();if(s.type!==1)throw new Error(`Invalid range end: ${s.text}`);return{type:"range",sheet:r,start:o,end:s.text}}default:throw new Error(`Unexpected token in led: ${e.text}`)}}lbp(e){return e.type===2?Cn[e.text]||0:e.type===5?30:0}expect(e){let n=this.next();if(n.type!==e)throw new Error(`Expected ${Ne[e]}, got ${n.text}`)}};var Qt=t=>Array.isArray(t)?t:[t],yn={SUM:t=>t.flatMap(Qt).reduce((e,n)=>e+n,0),AVERAGE:t=>{let e=t.flatMap(Qt);if(e.length===0)throw new Error("AVERAGE: no values");return e.reduce((n,o)=>n+o,0)/e.length},MIN:t=>{let e=t.flatMap(Qt);if(e.length===0)throw new Error("MIN: no values");return Math.min(...e)},MAX:t=>{let e=t.flatMap(Qt);if(e.length===0)throw new Error("MAX: no values");return Math.max(...e)},COUNT:t=>t.flatMap(Qt).filter(e=>typeof e=="number").length};function ce(t,e,n){let o=new Dt(t).parseExpression(),r=ae(o,e,n);if(typeof r=="number")return r;throw new Error(`Formula did not evaluate to a single number: ${t}`)}function ae(t,e,n){switch(t.type){case"number":return t.value;case"cell":{let[o,r]=Zt(t.id),s=t.sheet||e,i=n[s];if(!i)throw new Error(`Sheet not found: ${s}`);let a=wt(o,r),u=i[a];if(!u)throw new Error(`Cell ${t.id} not found in sheet ${s}`);return ce(u.text,s,n)}case"range":return ro(t,e,n);case"binary":{let o=ae(t.left,e,n),r=ae(t.right,e,n);if(Array.isArray(o)||Array.isArray(r))throw new Error("Cannot use + - * / on arrays");switch(t.op){case"+":return o+r;case"-":return o-r;case"*":return o*r;case"/":return o/r;default:throw new Error(`Unknown operator: ${t.op}`)}}case"func":{let o=t.args.map(i=>ae(i,e,n)),r=t.name.toUpperCase(),s=yn[r];if(!s)throw new Error(`Unknown function: ${t.name}`);return s(o)}}}function ro(t,e,n){let o=t.sheet||e,r=n[o];if(!r)throw new Error(`Sheet not found: ${o}`);let s=/^[A-Z]+$/.test(t.start)&&t.start===t.end,i=/^[a-z]+$/.test(t.start)&&t.start===t.end,a,u,l,d;if(s)a=mt(t.start),u=a,l=xt("a"),d=xt("z");else if(i)l=xt(t.start),d=l,a=mt("A"),u=mt("Z");else{let[C,h]=Zt(t.start),[S,b]=Zt(t.end);a=C,l=h,u=S,d=b}let c=[];for(let C=a;C<=u;C++)for(let h=l;h<=d;h++){let S=wt(C,h),b=r[S];if(b){let x=ce(b.text,o,n);c.push(x)}}return c}function Kt(t){switch(t.type){case"number":return t.value.toString();case"cell":{let[e,n]=Zt(t.id);return(t.sheet?`${t.sheet}!`:"")+Tt(e)+Lt(n)}case"range":{let e=t.start,n=t.end;return`${t.sheet?`${t.sheet}!`:""}${e}:${n}`}case"binary":return`${Kt(t.left)}${t.op}${Kt(t.right)}`;case"func":return`${t.name}(${t.args.map(Kt).join(",")})`}}function qt(t,e,n){let o=r=>{let[s,i]=Zt(r),a=e&&i>=n?s:!e&&s>=n?s+1:s,u=e&&i>=n?i+1:(!e&&s>=n,i);return Tt(a)+Lt(u)};switch(t.type){case"cell":return{...t,id:o(t.id)};case"range":return{...t,start:o(t.start),end:o(t.end)};case"binary":return{type:"binary",op:t.op,left:qt(t.left,e,n),right:qt(t.right,e,n)};case"func":return{type:"func",name:t.name,args:t.args.map(r=>qt(r,e,n))};default:return t}}function Zt(t){let e=t.match(/^([A-Z]+)([a-z]+)$/);if(!e)throw new Error(`Invalid cell ID: ${t}`);return[mt(e[1]),xt(e[2])]}var[K,$n]=T(new DOMRect),[Rn,ue]=T(""),[vt,Pe]=T(!1),[wn,En]=T(),[O,vn]=T({x:0,y:0}),[Sn,Be]=T(!1),[Ut,St]=T(""),[Mt,jn]=T(),[Ge,ze]=T(!1),[st,so]=T({x:0,y:0,col:0,row:0,width:G,height:V,id:"Aa"}),ft={start:0,end:0,text:""};function Jt(){return U(p().selectedRegions().values().next().value||"0,0:0,0")}function fe(){so.byRef(t=>{let e=Jt();t.id=Gt(e.startCol,e.startRow);let n=ut({startCol:e.startCol,startRow:e.startRow,endCol:e.startCol,endRow:e.startRow});t.col=e.startCol,t.row=e.startRow,t.x=n[0],t.y=n[1],t.width=n[2],t.height=n[3]})}var[Z,An]=T(matchMedia("(prefers-color-scheme: dark)").matches),[Ct,io]=T();W(()=>{io(Z()?Fe:ke)});var[We,Tn]=T(pn(10)),[Ln,In]=T(X.identity());function de(t){let[e,n]=T(t),[o,r]=T(new Set(["0,0:0,0"])),[s,i]=T(new Set),[a,u]=T([]),[l,d]=T({}),[c,C]=T({}),[h,S]=T({}),[b,x]=T([]),[j,g]=T({}),[f,m]=T({});return{name:e,setName:n,lastSelectedRegions:o,setLastSelectedRegions:r,selectedRegions:s,setSelectedRegions:i,selectedQuads:a,setSelectedQuads:u,colorRegions:l,setColorRegions:d,colorQuads:c,setColorQuads:C,textCells:h,setTextCells:S,textQuads:b,setTextQuads:x,colOffsets:j,setColOffsets:g,rowOffsets:f,setRowOffsets:m}}function jt(t){let e={};for(let n of rt())e[n.name()]=n.textCells();for(let n of Object.values(t))try{n.computed=n.text[0]==="="?ce(n.text.slice(1),p().name(),e).toString():n.text}catch(o){n.computed=o}}function me(t,e){let n=p().selectedRegions(),o={};for(let r in t){let s=+r,i=s%D,a=Math.floor(s/D),u={startCol:i,startRow:a,endCol:i,endRow:a};for(let l of n)o[l]||(o[l]=U(l)),at(u,o[l])&&e(t[s],s)}}var On=0,[rt,xe]=T([de(`sheet${On++}`)]),[p,Nt]=T(rt()[0]);N(()=>p().name(),()=>{location.hash=`#${encodeURIComponent(p().name())}`});function Fn(){xe.byRef(t=>{let e=t.length;t.push(de(`sheet${On++}`)),Nt(t[e])})}function kn(t){rt()[t]===p()&&Nt(t===0?rt()[1]:rt()[t-1]),xe.byRef(e=>e.splice(t,1))}W(()=>{document.documentElement.classList[Z()?"add":"remove"]("dark")});function Ft(t){return G+(p().colOffsets()[t]??0)}function kt(t){return V+(p().rowOffsets()[t]??0)}function Dn(t,e,n,o){let r=Object.keys(e).map(Number).sort((u,l)=>u-l),s=0,i=0;for(let u of r){if(u>s){let c=(u-s)*n;if(i+c>=t){let C=Math.floor((t-i)/n);return{index:s+C,remainder:(t-i)%n}}i+=c,s=u}let l=o(u);if(i+l>=t)return{index:u,remainder:t-i};i+=l,s=u+1}let a=Math.floor((t-i)/n);return{index:s+a,remainder:(t-i)%n}}function yt(t){return Dn(t,p().colOffsets(),G,Ft)}function $t(t){return Dn(t,p().rowOffsets(),V,kt)}function Un(){let t=document.createElement("canvas");t.style.background="transparent";let e=t.getContext("2d");if(!e)throw new Error("Failed to create canvas 2d context");return[t,e]}var[rs,ss]=Un();function Mn(t){let e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,lo),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e}var[lo,is]=Un();function Nn(t,e,n){let o=t.createShader(n);if(o==null)return new Error(`Could not create shader
	type: ${n}
	source: ${e}`);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){let r=t.getShaderInfoLog(o);return t.deleteShader(o),new Error(`[${go(n)}] Shader compilation failed: ${r}`)}return o}function ao(t,e,n){let o=t.getContext("webgl2");if(!o)return new Error("WebGL not supported.");o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.enable(o.DEPTH_TEST),o.clearColor(0,0,0,0);let r=Nn(o,e,o.VERTEX_SHADER);if(r instanceof Error)return r;let s=Nn(o,n,o.FRAGMENT_SHADER);if(s instanceof Error)return s;let i=o.createProgram();return o.attachShader(i,r),o.attachShader(i,s),o.linkProgram(i),o.getProgramParameter(i,o.LINK_STATUS)?(o.useProgram(i),{gl:o,program:i}):new Error(`Program link failed: ${o.getProgramInfoLog(i)}`)}function co(t,e){let n=t.getUniformLocation(e,"projection");return n?{projection:n,position:t.getAttribLocation(e,"position"),model:t.getAttribLocation(e,"instModel"),color:t.getAttribLocation(e,"instColor"),hasUV:t.getAttribLocation(e,"instHasUV"),uv:t.getAttribLocation(e,"instUV")}:new Error("Missing shader projection")}async function Pn(t,e,n,o){let r=ao(t,e,n);if(r instanceof Error)return r;Mn(r.gl);let s=co(r.gl,r.program);if(s instanceof Error)return s;let i=r.gl,a=i.createBuffer(),u=i.createBuffer(),l=i.createBuffer(),d=0,c=0;d=Le(d+o.vertex.byteLength,16),c=Le(c+o.index.byteLength,16),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,d,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,u),i.bufferData(i.ELEMENT_ARRAY_BUFFER,c,i.STATIC_DRAW);let C={id:i.createVertexArray(),drawMode:i[o.drawMode],instanceData:o.instance,numInstances:o.instance.length/ot,numIndices:o.index.length};i.bindVertexArray(C.id),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferSubData(i.ARRAY_BUFFER,0,o.vertex),i.enableVertexAttribArray(s.position),i.vertexAttribPointer(s.position,2,i.FLOAT,!1,hn,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,u),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,o.index);let h={gl:r.gl,inputs:s,shader:C,staticBuf:a,indexBuf:u,dynamicBuf:l,dynamicCap:Ot*1e4,shouldRedraw:!1,initDynamicBuffer:fo,resizeDynamicBuffer:uo,resizeInstances:mo,requestRedraw:xo,draw:po,render:ho};return h.initDynamicBuffer(),h}function uo(t,e){let n=this.dynamicBuf;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n);let o=this.gl.createBuffer();if(!o)throw new Error("Failed to create a new buffer");return console.log("RESIZE FROM %d TO %d",this.dynamicCap,t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,e),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.shader.instanceData),this.gl.deleteBuffer(n),this.dynamicBuf=o,this.dynamicCap=t,this.initDynamicBuffer(),o}function fo(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.dynamicBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.dynamicCap,this.gl.DYNAMIC_DRAW),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.shader.instanceData);for(let t=0;t<4;t++){let e=this.inputs.model+t;this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,4,this.gl.FLOAT,!1,Ot,t*16),this.gl.vertexAttribDivisor(e,1)}this.gl.enableVertexAttribArray(this.inputs.color),this.gl.vertexAttribPointer(this.inputs.color,4,this.gl.FLOAT,!1,Ot,16*Ht),this.gl.vertexAttribDivisor(this.inputs.color,1),this.gl.enableVertexAttribArray(this.inputs.uv),this.gl.vertexAttribPointer(this.inputs.uv,4,this.gl.FLOAT,!1,Ot,20*Ht),this.gl.vertexAttribDivisor(this.inputs.uv,1),this.gl.enableVertexAttribArray(this.inputs.hasUV),this.gl.vertexAttribPointer(this.inputs.hasUV,1,this.gl.FLOAT,!1,Ot,24*Ht),this.gl.vertexAttribDivisor(this.inputs.hasUV,1)}function mo(t,e){if(t.instanceData=e,t.instanceData.byteLength>=this.dynamicCap){let n=t.instanceData.byteLength*2;this.resizeDynamicBuffer(n,this.gl.DYNAMIC_DRAW)}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.dynamicBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,t.instanceData)}function xo(){this.shouldRedraw=!0}function po(){this.gl&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.bindVertexArray(this.shader.id),this.gl.drawElementsInstanced(this.shader.drawMode,this.shader.numIndices,this.gl.UNSIGNED_BYTE,0,this.shader.instanceData.length/ot))}function ho(){this.shouldRedraw&&(this.draw(),this.shouldRedraw=!1),requestAnimationFrame(this.render.bind(this))}function go(t){switch(t){case WebGLRenderingContext.VERTEX_SHADER:return"VERTEX_SHADER";case WebGLRenderingContext.FRAGMENT_SHADER:return"FRAGMENT_SHADER";case WebGLRenderingContext.TEXTURE_2D:return"TEXTURE_2D";case WebGLRenderingContext.TEXTURE_CUBE_MAP:return"TEXTURE_CUBE_MAP";case WebGLRenderingContext.COLOR_BUFFER_BIT:return"COLOR_BUFFER_BIT";case WebGLRenderingContext.DEPTH_BUFFER_BIT:return"DEPTH_BUFFER_BIT";case WebGLRenderingContext.STENCIL_BUFFER_BIT:return"STENCIL_BUFFER_BIT";case WebGLRenderingContext.ARRAY_BUFFER:return"ARRAY_BUFFER";case WebGLRenderingContext.ELEMENT_ARRAY_BUFFER:return"ELEMENT_ARRAY_BUFFER";case WebGLRenderingContext.STREAM_DRAW:return"STREAM_DRAW";case WebGLRenderingContext.STATIC_DRAW:return"STATIC_DRAW";case WebGLRenderingContext.DYNAMIC_DRAW:return"DYNAMIC_DRAW";case WebGLRenderingContext.FLOAT:return"FLOAT";case WebGLRenderingContext.UNSIGNED_BYTE:return"UNSIGNED_BYTE";case WebGLRenderingContext.UNSIGNED_SHORT:return"UNSIGNED_SHORT";case WebGLRenderingContext.UNSIGNED_INT:return"UNSIGNED_INT";case WebGLRenderingContext.DEPTH_TEST:return"DEPTH_TEST";case WebGLRenderingContext.LEQUAL:return"LEQUAL";case WebGLRenderingContext.LESS:return"LESS";case WebGLRenderingContext.EQUAL:return"EQUAL";case WebGLRenderingContext.GREATER:return"GREATER";case WebGLRenderingContext.NOTEQUAL:return"NOTEQUAL";case WebGLRenderingContext.GEQUAL:return"GEQUAL";case WebGLRenderingContext.ALWAYS:return"ALWAYS";case WebGLRenderingContext.NEVER:return"NEVER";default:return`Unknown GLenum (0x${t.toString(16)})`}}var bo=E('<canvas class="w-full h-full"></canvas>'),Pt,Y,Ve;function Bn(t){!Ve||!Y||Y.resizeInstances(Ve,t)}function pe(){queueMicrotask(async()=>{if(new ResizeObserver(()=>$n(Pt.getBoundingClientRect())).observe(Pt),Y=await Pn(Pt,`#version 300 es

in vec2 position;

in mat4 instModel;
in vec4 instColor;
in vec4 instUV;
in float instHasUV;

uniform mat4 projection;

out vec4 vertColor;
out vec2 fragUV;
out float hasUV;

void main() {
  vertColor = instColor;
  fragUV = mix(instUV.xy, instUV.zw, position);
  hasUV = instHasUV;
  gl_Position = projection * instModel * vec4(position, 0.0, 1.0);
}
`,`#version 300 es
precision mediump float;

in vec4 vertColor;
in vec2 fragUV;
in float hasUV;

uniform sampler2D sampler;

out vec4 fragColor;

void main() {
  float useTexture = hasUV * step(0.0, fragUV.x) * step(0.0, fragUV.y);
  fragColor = mix(vertColor, texture(sampler, fragUV), useTexture);
}
`,{drawMode:"TRIANGLE_STRIP",instance:We().data,vertex:Ue.vertexData,index:Ue.indexData}),Y instanceof Error)return console.error(Y);Ve=Y.shader,t(),Y.render()}),W(()=>{Z(),Y?.gl.clearColor(0,0,0,0)}),Ee([Z,Ln,We],()=>{Y?.requestRedraw()}),Ee([K,O],()=>t());function t(){let{width:e,height:n}=K();!Y||!e||!n||(Y.gl.clear(Y.gl.COLOR_BUFFER_BIT),Pt.width=e,Pt.height=n,Y.gl.viewport(0,0,e,n),In.byRef(o=>{X.ortho(0,e,n,0,-1,1e3,o);let r=O();(r.x||r.y)&&X.translatePx(o,-r.x,-r.y,0),Y.gl.uniformMatrix4fv(Y.inputs.projection,!1,o)}))}return(()=>{let e=bo();return Pt=e,e})()}N(()=>[K(),p().colorQuads(),p().colOffsets(),p().rowOffsets(),O(),Z()],()=>{let{width:t,height:e}=K(),n=t+G,o=e+V,r=Math.ceil(n/G),s=Math.ceil(o/V),i=nn,a=ln;Z()||(i=on,a=an);let u=Ie(O().x,G),l=Ie(O().y,V),d=yt(O().x),c=$t(O().y),C={startCol:d.index,startRow:c.index,endCol:d.index+r,endRow:c.index+s},h=(x,j)=>{let g=0,f=0,m=[];for(let y of x){let A=U(y);at(A,C)&&(m.push(...j.slice(g,g+4)),f++),g+=4}return[m,f]},S={},b=[];for(let x in p().colorQuads()){let j=p().colorQuads()[x],[g,f]=h(p().colorRegions()[x],j);f!==0&&(S[x]=g,b.push(f))}Tn.byRef(x=>{let j=b.reduce((m,y)=>m+y,0);x.resize(s+r+j);let g=0;for(let m=0;m<r;m++){let y=d.index+m-1,A=lt(d.index,y,p().colOffsets()),$=x.modelAt(m);X.scaleIdentity($,Oe,o,1),X.translateTo($,m*G+O().x+A-d.remainder,l,10),x.colorAt(m).set(i),x.hasUVAt(m)[0]=0}g+=r;for(let m=0;m<s;m++){let y=c.index+m-1,A=lt(c.index,y,p().rowOffsets()),$=x.modelAt(m+g);X.scaleIdentity($,n,Oe,1),X.translateTo($,u,m*V+O().y+A-c.remainder,10),x.colorAt(m+r).set(i),x.hasUVAt(m+r)[0]=0}g+=s;let f=0;for(let m in S){let y=S[m];_o(x,y,g,Et(m),f/10),g+=b[f++]}Bn(x.data)})});function _o(t,e,n,o,r=0){let s=n;for(let i=0;i<e.length;i+=4){let[a,u,l,d]=e.slice(i,i+4),c=o??(Z()?rn:sn);t.hasUVAt(s)[0]=0,t.colorAt(s).set(c);let C=t.modelAt(s);X.scaleIdentity(C,l,d,1),X.translateTo(C,a,u,r),s++}}var Co=E('<dialog class="grid-rows-[auto_1fr] absolute border-2 border-slate-900 dark:border-emerald-300 rounded-md whitespace-break-spaces max-w-3/4 max-h-3/4 left-0 top-0 z-100 bg-zinc-100/75 text-zinc-900 dark:bg-zinc-900/75 dark:text-zinc-100 font-mono"><header class="flex justify-between p-2 bg-slate-900 text-zinc-50 dark:bg-emerald-300 dark:text-zinc-900"><h1 class="text-lg font-bold"><!></h1><button data-icon type="button" class="plain">\uF00D</button></header><article><slot></slot></article></dialog>');window._jsx$global_event_touchmove=window._jsx$global_event_touchmove||Q("touchmove");window._jsx$global_event_touchend=window._jsx$global_event_touchend||Q("touchend");window._jsx$global_event_mousemove=window._jsx$global_event_mousemove||Q("mousemove");window._jsx$global_event_mouseup=window._jsx$global_event_mouseup||Q("mouseup");function he(t){let e=dt({x:t.x||0,y:t.y||0}),n=dt({x:e.x,y:e.y}),o=dt({x:e.x,y:e.y}),[r,s]=T(!1);function i(l){if(!t.draggable||(l.target instanceof HTMLButtonElement||l.target instanceof HTMLInputElement||l.preventDefault(),l instanceof MouseEvent&&l.button!==0))return;s(!0);let d=pt(l);n.x=d.x,n.y=d.y,a(l)}function a(l){if(!r())return;let d=pt(l);e.x=o.x+d.x-n.x,e.y=o.y+d.y-n.y}function u(){s(!1),o.x=e.x,o.y=e.y}return(()=>{let l=Co(),d=l.firstChild,c=d.firstChild,C=c.firstChild,h=c.nextSibling,S=h.firstChild,b=d.nextSibling,x=b.firstChild;return B(l,"open",()=>t.open),q(l,"grid",()=>t.open),L(l,"left",()=>`${e.x}px`),L(l,"top",()=>`${e.y}px`),P(window._jsx$global_event_touchmove,l,a),P(window._jsx$global_event_touchend,l,u),P(window._jsx$global_event_mousemove,l,a),P(window._jsx$global_event_mouseup,l,u),q(d,"cursor-grab",()=>!r()),q(d,"cursor-grabbing",()=>r()),v(d,"mousedown",i),v(d,"touchstart",i),w(C,()=>t.title),v(h,"click",()=>t.onClose(!1)),v(h,"touchend",()=>t.onClose(!1)),k(b,"data-dialog-id",t.id),k(b,"class",`p-2 overflow-auto ${t.class}`),w(x,arguments[1]?.default?.()),l})()}function it(t,e){let n=()=>(t.to?t.to instanceof Element?t.$ref=t.to:t.$ref=document.querySelector(t.to)||document.body:t.$ref=document.body,t.$ref),o=document.createComment(""),r=e.default?.();return queueMicrotask(()=>{o.addEventListener("destroy",()=>{r.forEach(At),o.remove()})}),W(()=>{n().append(...r)}),o}var yo=E("<pre><slot></slot></pre>");function ht(){return it.$$slots={default:()=>[(()=>{let e=yo(),n=e.firstChild;return w(n,arguments[1]?.default?.()),e})()]},it({to:"[data-dialog-id=dbg]"},it.$$slots)}function et(t){let e=Ze(),n=document.createComment("For"),o=[],r=t.each.map(i),s=t.each.length;queueMicrotask(()=>{!n.isConnected&&!n.parentElement&&console.warn("<For> failed to mount"),e.setFromElement(n),n.remove(),r.forEach((u,l)=>{let d=r[l-1],c;return d?.isConnected?c=d.after.bind(d):c=e.getInsertFunction(),c(u)})});function i(u,l){let[d,c]=T(u),C=d();C&&typeof C=="object"&&(Bt(C)?C.listeners.clear():dt(C));let h=!1;return W(()=>{if(h)return;let S=t.each[l];S&&typeof S=="object"&&!Bt(S)&&dt(S),d()!==S&&(o[l]=S,S===void 0?(h=!0,a()):c(S))}),o.push(d()),t.do(d,l)}function a(){if(t.each.length<s){if(o[s-1]!==void 0)return;for(let u=s-1;u>=t.each.length;u--)At(r[u]);s=o.length=r.length=t.each.length}}return W(()=>{if(t.each.length>s){for(let u=s;u<t.each.length;u++){let l=r[u-1],d;l?.isConnected?d=l.after.bind(l):d=e.getInsertFunction();let c=i(t.each[u],u);d(c),r.push(c)}s=o.length=r.length=t.each.length}else t.each.length<s&&a()}),n}function te(t){return t.each.map((e,n)=>{let[o,r]=T(t.each[n]),s=o();return s&&typeof s=="object"&&!Bt(s)&&dt(s),W(()=>{let i=t.each[n];o()!==i&&r(i)}),t.do(o,n)})}var $o=E('<fieldset data-button class="compact relative flex items-center outline rounded-sm h-full"><button data-icon class="plain py-1 px-2 rounded-sm" type="button" title="Clear">\uF00D</button><input type="color" class="w-7 h-full peer cursor-pointer opacity-0 rounded-sm"/><div class="w-7 h-full p-1 text-xs focus-sibling pointer-events-none absolute right-0 flex items-center justify-center rounded-sm flex-col"><slot></slot><div class="w-full h-3 outlined"></div></div></fieldset>');function gt(t){return(()=>{let e=$o(),n=e.firstChild,o=n.firstChild,r=n.nextSibling,i=r.nextSibling.firstChild,a=i.nextSibling;return v(n,"click",()=>t.onChange(t.defaultColor??"")),B(r,"value",()=>t.color),v(r,"input",u=>t.onChange(u.currentTarget.value)),w(i,arguments[1]?.default?.()),L(a,"background-color",()=>t.color),e})()}var Ro=E('<label data-button class="relative focus-children has-checked:bg-indigo-500! has-checked:hover:bg-indigo-700! has-checked:text-zinc-100! dark:has-checked:bg-emerald-500! dark:has-checked:text-zinc-900! dark:has-checked:hover:bg-emerald-200! rounded-square"><input type="checkbox" class="opacity-0 absolute pointer-events-none"/><slot></slot></label>');function J(t){return(()=>{let e=Ro(),n=e.firstChild,o=n.nextSibling;return k(n,"checked",t.checked),v(n,"change",r=>t.onChange(r.currentTarget.checked)),w(o,arguments[1]?.default?.()),e})()}var wo=E("<strong>B</strong>"),Eo=E("<u>U</u>"),vo=E("<s>S</s>"),So=E("<strong>Aa</strong>"),jo=E('<fieldset><select class="h-full"><!></select><select class="h-full"><!></select><fieldset class="grid grid-cols-[1rem_3rem_1rem]"><button type="button" class="compact">-</button><input class="text-center"/><button type="button" class="compact">+</button></fieldset><div></div><!><!><!><!><div></div><!></fieldset>'),Ao=E("<option><!></option>"),To=E("<option><!></option>"),Lo=E("<em>I</em>");function ge(){function t(e,n){ko.byRef(o=>{o[e]=n}),p().setTextCells.byRef(o=>{me(o,r=>{r.style[e]=n})})}return(()=>{let e=jo(),n=e.firstChild,o=n.firstChild,r=n.nextSibling,s=r.firstChild,i=r.nextSibling,a=i.firstChild,u=a.firstChild,l=a.nextSibling,d=l.nextSibling,c=d.firstChild,C=i.nextSibling,h=C.nextSibling,S=h.nextSibling,b=S.nextSibling,x=b.nextSibling,j=x.nextSibling,g=j.nextSibling;return k(e,"class",`flex gap-2 h-full *:flex-none ${tn?"*:w-max":""}`),v(n,"change",f=>t("family",f.currentTarget.value)),te.$$slots={},w(o,te({get each(){return Fo},do:f=>(()=>{let m=Ao(),y=m.firstChild;return k(m,"selected",f()===M().family),w(y,()=>f()),m})()})),v(r,"change",f=>t("format",f.currentTarget.value)),te.$$slots={},w(s,te({get each(){return Oo},do:f=>(()=>{let m=To(),y=m.firstChild;return k(m,"selected",f()===M().format),w(y,()=>f()),m})()})),v(a,"click",()=>t("size",M().size-1)),B(l,"value",()=>M().size),v(l,"input",f=>t("size",+f.currentTarget.value)),v(d,"click",()=>t("size",M().size+1)),k(C,"class",_t),J.$$slots={default:()=>[(()=>{let f=wo(),m=f.firstChild;return f})()]},w(h,J({get checked(){return M().bold},onChange:f=>t("bold",f)},J.$$slots)),J.$$slots={default:()=>[(()=>{let f=Lo(),m=f.firstChild;return f})()]},w(S,J({get checked(){return M().italic},onChange:f=>t("italic",f)},J.$$slots)),J.$$slots={default:()=>[(()=>{let f=Eo(),m=f.firstChild;return f})()]},w(b,J({get checked(){return M().underline},onChange:f=>t("underline",f)},J.$$slots)),J.$$slots={default:()=>[(()=>{let f=vo(),m=f.firstChild;return f})()]},w(x,J({get checked(){return M().strikethrough},onChange:f=>t("strikethrough",f)},J.$$slots)),k(j,"class",_t),gt.$$slots={default:()=>[(()=>{let f=So(),m=f.firstChild;return f})()]},w(g,gt({get color(){return M().color},onChange:f=>t("format",f)},gt.$$slots)),e})()}var Io=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function He(t,e){let n=Number(t);return Number.isNaN(n)?t:e(n)}var Xe={Number:t=>He(t,e=>e%1===0?t:e.toFixed(2)),Currency:t=>He(t,e=>Io.format(e)),Date:t=>{try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return t}},Integer:t=>He(t,e=>Math.floor(e))},Oo=Object.keys(Xe),Fo=["Amatic SC","Caveat","Comfortaa","Courier Prime","EB Garamond","Exo","JetBrainsMono","Lexend","Lobster","Lora","Merriweather","Montserrat","Nunito","Oswald","Pacifico","Playfair Display","Roboto","Roboto Mono","Roboto Serif","Spectral"],[M,ko]=T({family:zt,size:Wt,color:Vt,bold:cn,italic:un,underline:fn,strikethrough:dn,format:ie});var Do=E('<div class="absolute text-wrap break-all py-1 px-2"><!><!></div>'),Uo=E("<span><!></span>"),Mo=E("<p>Colored:<!><!></p>"),No=E("<p>inputCellInfo: <!></p>"),Po=E('<div class="absolute right-0"><div tabindex="0"><!></div><!><pre class="absolute z-10 h-8 w-25 p-1 outline outline-indigo-500 dark:outline-emerald-500 whitespace-pre-wrap pointer-events-none"><!><strong class="absolute -top-6 -left-1 p-1 font-mono"><!></strong></pre></div>'),Bo=E('<div class="absolute bg-indigo-500/50 dark:bg-emerald-500/50 pointer-events-none"><!></div>'),Go=E('<button type="button" class="absolute no-color bg-indigo-500 dark:bg-emerald-500 rounded-full w-6 h-6 bottom-0 right-0 translate-1/2 pointer-events-auto"></button>'),zo=E("<p>ColOffsets: <!></p>"),Wo=E('<strong class="font-mono text-base font-bold not-italic text-red-500">#ERROR!</strong>'),Vo=E("<p>Texts: <!></p>"),Ho=E("<p>Selected:<!><!></p>"),Xo=E("<p>RowOffsets: <!></p>");window._jsx$global_event_pointermove=window._jsx$global_event_pointermove||Q("pointermove");function be(){let t=!1,e,n,o={},r={},s={};N(O,()=>{e=yt(O().x),n=$t(O().y)});function i(b){t&&l(b)}function a(b){b.preventDefault(),c(b,s),(o.col==null||s.col<o.col)&&(o={...s}),(r.row==null||s.row<r.row)&&(r={...s}),l(b),t=!0}N(Z,u);function u(){let b,x={startCol:s.col,startRow:s.row,endCol:s.col,endRow:s.row};for(let j in p().colorRegions()){for(let g of p().colorRegions()[j]){let f=U(g);if(at(f,x)){b=j;break}}if(b)break}ue(b??Ct())}function l(b){let x=c(b),j=Math.min(s.col,x.col),g=Math.max(s.col,x.col),f=Math.min(s.row,x.row),m=Math.max(s.row,x.row);vt()||p().setLastSelectedRegions.byRef(A=>A.clear());let y=new Set(p().lastSelectedRegions());if(Xt(y,j,f,g,m),p().setSelectedRegions(y),Ut()[0]!=="=")Mt().blur();else if(document.activeElement===Mt()){let A=p().selectedRegions();if(!A.size)return;let $="";for(let _ of A){let R=U(_);if(R.startCol===st().col&&R.startRow===st().row)return;$&&($+=","),$+=Gt(R.startCol,R.startRow),(R.startCol!==R.endCol||R.startRow!==R.endRow)&&($=`${$}:${Gt(R.endCol,R.endRow)}`)}St(ft.text.slice(0,ft.start)+$+ft.text.slice(ft.end)),Mt().selectionStart=Mt().selectionEnd=ft.start+$.length}}N(()=>[p().selectedRegions(),p().textCells(),p().colOffsets(),p().rowOffsets()],b=>{b instanceof Set||(s={...b===p().colOffsets()?o:r},C(s)),p().setSelectedQuads.byRef(x=>{x.length=0;for(let j of p().selectedRegions()){let g=ut(U(j));x.push({x:g[0],y:g[1],w:g[2],h:g[3]})}}),p().setTextQuads.byRef(x=>{x.length=0;for(let j in p().textCells()){let g=+j,f=g%D,m=Math.floor(g/D),y=ut({startCol:f,startRow:m,endCol:f,endRow:m});x.push({cell:p().textCells()[j],x:y[0],y:y[1],w:y[2],h:y[3]})}})}),N(()=>p().lastSelectedRegions(),()=>p().setSelectedRegions(new Set(p().lastSelectedRegions())));function d(b){bt&&(t||a(b),Be(!1)),t&&(t=!1,p().setLastSelectedRegions(new Set(p().selectedRegions())))}function c(b,x={}){let j=pt(b);return x.col=yt(O().x+j.x-K().x).index,x.row=$t(O().y+j.y-K().y).index,C(x),x}function C(b){b.x=(b.col-e.index)*G+O().x+lt(e.index,b.col-1,p().colOffsets())-e.remainder,b.y=(b.row-n.index)*V+O().y+lt(n.index,b.row-1,p().rowOffsets())-n.remainder}function h(){fe(),Mt().focus()}function S(){if(!Ge()){let b=Jt();St(p().textCells()[wt(b.startCol,b.startRow)]?.text??"")}}return[(()=>{let b=Po(),x=b.firstChild,j=x.firstChild,g=x.nextSibling,f=g.nextSibling,m=f.firstChild,A=m.nextSibling.firstChild;return En(b),q(b,"overflow-auto",()=>!Sn()),L(b,"top",()=>`${K().y}px`),L(b,"width",()=>`${K().width}px`),L(b,"height",()=>`${K().height}px`),v(b,"scroll",$=>vn({x:$.currentTarget.scrollLeft,y:$.currentTarget.scrollTop})),L(x,"width",()=>`${G*D+Te(p().colOffsets())}px`),L(x,"height",()=>`${V*It+Te(p().rowOffsets())}px`),v(x,"pointerdown",bt?void 0:$=>a($)),P(window._jsx$global_event_pointermove,x,i),v(x,"pointerup",d),v(x,"click",S),v(x,"dblclick",h),et.$$slots={},w(j,et({get each(){return p().textQuads()},do:$=>(()=>{let _=Do(),R=_.firstChild,F=R.nextSibling;return L(_,"font-family",()=>$().cell.style.family),L(_,"font-size",()=>`${$().cell.style.size}px`),L(_,"font-weight",()=>$().cell.style.bold?"bold":"normal"),L(_,"font-style",()=>$().cell.style.italic?"italic":"normal"),L(_,"text-decoration-line",()=>$().cell.computed instanceof Error?"":`${$().cell.style.underline?"underline ":""}${$().cell.style.strikethrough?"line-through":""}`),L(_,"color",()=>$().cell.style.color),L(_,"left",()=>`${$().x}px`),L(_,"top",()=>`${$().y}px`),L(_,"width",()=>`${$().w}px`),L(_,"height",()=>`${$().h}px`),se(R,()=>{let I=Wo(),z=I.firstChild;return B(I,"title",()=>$().cell.computed.toString()),I},()=>$().cell.computed instanceof Error),se(F,()=>{let I=Uo(),z=I.firstChild;return w(z,()=>Xe[$().cell.style.format]($().cell.computed)),I},()=>typeof $().cell.computed=="string"),_})()})),et.$$slots={},w(g,et({get each(){return p().selectedQuads()},do:$=>(()=>{let _=Bo(),R=_.firstChild;return L(_,"left",()=>`${$().x}px`),L(_,"top",()=>`${$().y}px`),L(_,"width",()=>`${$().w}px`),L(_,"height",()=>`${$().h}px`),se(R,()=>{let F=Go();return v(F,"pointerdown",()=>{Be(!0),t=!0}),F},()=>bt),_})()})),q(f,"hidden",()=>!Ge()),L(f,"background-color",()=>Ct()),L(f,"left",()=>`${st().x}px`),L(f,"top",()=>`${st().y}px`),L(f,"width",()=>`${st().width}px`),L(f,"height",()=>`${st().height}px`),L(f,"font-family",()=>M().family),L(f,"font-size",()=>`${M().size}px`),L(f,"font-weight",()=>M().bold?"bold":"normal"),L(f,"font-style",()=>M().italic?"italic":"normal"),L(f,"text-decoration-line",()=>`${M().underline?"underline ":""}${M().strikethrough?"line-through":""}`),L(f,"color",()=>M().color),w(m,()=>Ut()),w(A,()=>st().id),b})(),(ht.$$slots={default:()=>[(()=>{let x=Mo(),g=x.firstChild.nextSibling,f=g.nextSibling;return w(g," "),w(f,()=>JSON.stringify(p().colorRegions(),(m,y)=>y instanceof Set?Array.from(y):y,2)),x})(),(()=>{let x=Ho(),g=x.firstChild.nextSibling,f=g.nextSibling;return w(g," "),w(f,()=>JSON.stringify([...p().selectedRegions()],null,2)),x})(),(()=>{let x=Vo(),g=x.firstChild.nextSibling;return w(g,()=>JSON.stringify(p().textCells(),null,2)),x})(),(()=>{let x=zo(),g=x.firstChild.nextSibling;return w(g,()=>JSON.stringify(p().colOffsets())),x})(),(()=>{let x=Xo(),g=x.firstChild.nextSibling;return w(g,()=>JSON.stringify(p().rowOffsets())),x})(),(()=>{let x=No(),g=x.firstChild.nextSibling;return w(g,()=>JSON.stringify(st(),null,2)),x})()]},ht({},ht.$$slots))]}var Yo=E('<button type="button" class="relative"><!><div></div></button>'),Qo=E('<button type="button" class="block w-full px-2 min-w-[56.5px] relative"><!><div></div></button>'),Ko=E('<aside class="relative overflow-visible max-h-dvh z-10 select-none"><!></aside>'),qo=E('<button class="relative dark:bg-zinc-800 bg-zinc-200 z-11" data-icon type="button" title="Go to the 1st cell">\uF853</button>'),Zo=E('<header class="relative overflow-visible max-w-dvw whitespace-nowrap z-10 select-none"><!></header>');window._jsx$global_event_touchmove=window._jsx$global_event_touchmove||Q("touchmove");window._jsx$global_event_mousemove=window._jsx$global_event_mousemove||Q("mousemove");window._jsx$global_event_mouseup=window._jsx$global_event_mouseup||Q("mouseup");window._jsx$global_event_touchend=window._jsx$global_event_touchend||Q("touchend");var Gn="absolute z-1";function _e(){let[t,e]=T({cols:[],rows:[]});function n(g,f,m){let y=0,A=0,$=g;for(;y<f+m(g);)y+=m($),$++,A++;return A}N(()=>[K(),O(),p().colOffsets(),p().rowOffsets()],()=>{let{width:g,height:f}=K(),{index:m}=yt(O().x),{index:y}=$t(O().y);if(m<0&&y<0)return;let A=n(m,g,Ft),$=n(y,f,kt);e.byRef(_=>{if(m>=0){_.cols.length=0;for(let R=m;R<m+A;R++)_.cols.push(Tt(R))}if(y>=0){_.rows.length=0;for(let R=y;R<y+$;R++)_.rows.push(Lt(R))}})});let o={x:0,y:0},r=-1;function s(g,f){o=pt(g),r=mt(f)}let i=-1;function a(g,f){o=pt(g),i=xt(f)}function u(g,f,m,y){if(f===-1)return;let A=pt(g);m($=>{let _=($[f]??0)+(y===G?A.x-o.x:A.y-o.y);$[f]=Math.max(-y,_),o=A})}function l(){r=-1,i=-1}let d=O().x,c=O().x,[C,h]=T(0),[S,b]=T(0);N(O,()=>{if(O().x!==d){let g=yt(O().x).remainder;g>=0&&h(g),d=O().x}if(O().y!==c){let g=$t(O().y).remainder;g>=0&&b(g),c=O().y}});function x(g,f){g.target===g.currentTarget&&p().setLastSelectedRegions.byRef(m=>{vt()||m.clear(),Xt(m,f,0,f,It)})}function j(g,f){g.target===g.currentTarget&&p().setLastSelectedRegions.byRef(m=>{vt()||m.clear(),Xt(m,0,f,D,f)})}return[(()=>{let g=qo(),f=g.firstChild;return v(g,"click",()=>wn().scrollTo({top:0,left:0,behavior:"smooth"})),g})(),(()=>{let g=Zo(),f=g.firstChild;return L(g,"left",()=>`-${C()}px`),et.$$slots={},w(f,et({get each(){return t().cols},do:(m,y)=>(()=>{let A=Yo(),$=A.firstChild,_=$.nextSibling;return B(A,"tabindex",()=>y===t().cols.length-1?-1:void 0),v(A,"click",R=>x(R,mt(m()))),L(A,"width",()=>`${Ft(mt(m()))}px`),w($,()=>m()),k(_,"class",`${Gn} cursor-col-resize top-0 right-0 h-full w-3`),v(_,"mousedown",R=>s(R,m())),P(window._jsx$global_event_mousemove,_,R=>u(R,r,p().setColOffsets.byRef,G)),P(window._jsx$global_event_mouseup,_,l),v(_,"touchstart",R=>s(R,m())),P(window._jsx$global_event_touchmove,_,R=>u(R,r,p().setColOffsets.byRef,G)),P(window._jsx$global_event_touchend,_,l),A})()})),g})(),(()=>{let g=Ko(),f=g.firstChild;return L(g,"top",()=>`-${S()}px`),et.$$slots={},w(f,et({get each(){return t().rows},do:(m,y)=>(()=>{let A=Qo(),$=A.firstChild,_=$.nextSibling;return B(A,"tabindex",()=>y===t().rows.length-1?-1:void 0),v(A,"click",R=>j(R,xt(m()))),L(A,"height",()=>`${kt(xt(m()))}px`),w($,()=>m()),k(_,"class",`${Gn} cursor-row-resize left-0 bottom-0 w-full h-3`),v(_,"mousedown",R=>a(R,m())),P(window._jsx$global_event_mousemove,_,R=>u(R,i,p().setRowOffsets.byRef,V)),P(window._jsx$global_event_mouseup,_,l),v(_,"touchstart",R=>a(R,m())),P(window._jsx$global_event_touchmove,_,R=>u(R,i,p().setRowOffsets.byRef,V)),P(window._jsx$global_event_touchend,_,l),A})()})),g})()]}var Jo=E('<label class="flex gap-2 pl-6 items-center focus-children outlined"><i>\uF1EC</i><textarea class="w-full font-mono py-1 outline-none resize-none max-h-20" rows="1"></textarea></label>');function Ce(){let t=!0;function e(){if(ze(!1),!t){t=!0,St("");return}let i=Ut(),a=wt(st().col,st().row);i?p().setTextCells.byRef(u=>{u[a]={text:i,computed:i,style:{...M()}},jt(u)}):p().setTextCells.byRef(u=>delete u[a]),St("")}function n(){St(this.value),this.style.height="",this.style.height=`${this.scrollHeight}px`}function o(i){i.key==="Enter"&&!i.shiftKey?(i.preventDefault(),this.blur()):i.key==="Escape"&&(i.preventDefault(),t=!1,this.blur())}function r(i){i.key==="Shift"||i.key==="Control"||i.key==="Alt"||i.key==="Meta"||(ft.start=this.selectionStart,ft.end=this.selectionEnd,ft.text=this.value)}function s(){fe(),ze(!0)}return(()=>{let i=Jo(),a=i.firstChild,u=a.firstChild,l=a.nextSibling;return jn(l),B(l,"value",()=>Ut()),v(l,"keydown",o),v(l,"keyup",r),v(l,"input",n),v(l,"focus",s),v(l,"blur",e),i})()}var tr=E('<dialog class="outlined absolute h-auto left-1/2 top-1/2 -translate-1/2 grid-auto-row gap-2 justify-center items-center px-8 py-4 bg-zinc-200 text-zinc-800 dark:bg-zinc-800 dark:text-zinc-100 rounded-md"><slot></slot></dialog>');function ee(t){return it.$$slots={default:()=>[(()=>{let n=tr(),o=n.firstChild;return B(n,"open",()=>t.open),q(n,"grid",()=>t.open),w(o,arguments[1]?.default?.()),n})()]},it({to:"[data-alerts]"},it.$$slots)}var er=E('<div class="flex flex-col gap-1 outlined rounded-sm overflow-hidden relative ml-auto transition-[translate] -translate-y-[calc(100%+30px)] duration-500 min-w-40 max-w-70 bg-zinc-100 dark:bg-zinc-900"><header><i><!></i><slot name="header"></slot><button data-icon type="button" class="compact plain pl-4 pr-3 text-xs ml-auto">x</button></header><article class="px-2 pb-4 overflow-auto max-h-40"><slot></slot></article><div class="absolute left-0 bottom-0 w-full h-1 bg-zinc-900/25 dark:bg-zinc-100/25"><div></div></div></div>'),zn={info:"bg-indigo-500 text-zinc-100 dark:bg-emerald-500 dark:text-zinc-900",warn:"bg-yellow-500 text-zinc-900",error:"bg-rose-500 text-zinc-100"},nr={info:"\uF05A",warn:"\uF06A",error:"\uF071"},Wn=10,Ye=3e3;function ne(t){let[e,n]=T(0),o=-1,r=-1,s=0;N(()=>t.open,()=>{t.open&&(n(100),s=0,clearInterval(r),r=setInterval(()=>{n(100-s/Ye*100),s+=Wn,s>=Ye&&clearInterval(r)},Wn),clearTimeout(o),o=setTimeout(i,Ye))});function i(){t.onChange(!1),s=0,clearInterval(r),clearTimeout(o)}return it.$$slots={default:()=>[Je(document.createComment(""),()=>{let l=er(),d=l.firstChild,c=d.firstChild,C=c.firstChild,h=c.nextSibling,S=h.nextSibling,b=S.firstChild,x=d.nextSibling,j=x.firstChild,f=x.nextSibling.firstChild;return k(d,"class",`flex justify-end pl-3 gap-2 ${zn[t.level]}`),w(C,()=>nr[t.level]),w(h,arguments[1]?.header?.()),v(S,"click",i),w(j,arguments[1]?.default?.()),k(f,"class",`h-full ${zn[t.level]}`),L(f,"width",()=>`${e()}%`),l},()=>t.open,"slide")]},it({to:"[data-toasts]"},it.$$slots)}var or=E('<p class="text-wrap text-center">You can only use letters, digits and underscores</p>'),rr=E("<p>Are you sure you want to delete<!><strong><!></strong>?</p>"),sr=E("<p>ALERT: <!></p>"),ir=E('<footer class="grid grid-cols-[auto_minmax(0,1fr)] bg-zinc-200 dark:bg-zinc-800 outlined"><button type="button" data-icon title="Add new sheet" class="plain dark:text-emerald-500 hover:dark:text-emerald-200 text-indigo-500 hover:text-indigo-700 h-full w-[56.5px] h-full">+</button><nav role="tablist" class="relative flex gap-1 z-15 pr-3 pb-1 overflow-x-auto"><!><input class="absolute"/></nav><!><!><!></footer>'),lr=E('<menu class="grid grid-cols-2 gap-2"><button type="button" class="no-color rounded-sm text-zinc-100 bg-indigo-700 hover:bg-indigo-500 dark:text-zinc-900 dark:bg-emerald-500 dark:hover:bg-emerald-400"><strong>YES</strong></button><button type="button" class="no-color rounded-sm text-zinc-100 bg-red-800 hover:bg-red-600 dark:text-zinc-900 dark:bg-red-500 dark:hover:bg-red-400"><strong>NO</strong></button></menu>'),ar=E('<span data-button class="compact grid grid-cols-[minmax(0,1fr)_auto] rounded-b-sm dark:bg-zinc-800 bg-zinc-100 flex min-w-24"><a role="tab" class="py-1 pl-2"><!></a><button data-icon type="button" class="plain px-2 h-full text-red-800 hover:text-red-600 dark:text-red-300 dark:hover:text-red-400">\uF1F8</button></span>'),cr=E("<strong>Invalid name!</strong>");function ye(){let t,[e,n]=T({visible:!1,x:0,y:0}),[o,r]=T(p().name().length+1),[s,i]=T(0),[a,u]=T(!1),[l,d]=T(!1);function c(){if(!t.checkValidity())return d(!0);n.byRef(b=>{b.visible=!1}),t.value&&t.value!==p().name()&&p().setName(t.value)}function C(b){i(b),u(!0)}function h(){u(!1),kn(s())}function S(){Fn()}return window.addEventListener("hashchange",()=>{let b=decodeURIComponent(location.hash).slice(1),x=rt().find(j=>j.name()===b);x&&Nt(x)}),(()=>{let b=ir(),x=b.firstChild,j=x.firstChild,g=x.nextSibling,f=g.firstChild,m=f.nextSibling,y=g.nextSibling,A=y.nextSibling,$=A.nextSibling;return v(x,"click",S),et.$$slots={},w(f,et({get each(){return rt()},do:(_,R)=>(()=>{let F=ar(),I=F.firstChild,z=I.firstChild,tt=I.nextSibling,H=tt.firstChild;return q(F,"selected",()=>p()===_()),B(I,"href",()=>`#${encodeURIComponent(_().name())}`),v(I,"dblclick",Rt=>{n.byRef(re=>{re.visible=!0,re.x=Rt.currentTarget.offsetLeft,re.y=Rt.currentTarget.offsetTop}),t.focus()}),w(z,()=>_().name()),v(tt,"click",()=>C(R)),B(tt,"disabled",()=>rt().length===1),F})()})),t=m,q(m,"hidden",()=>!e().visible),B(m,"value",()=>p().name()),L(m,"left",()=>`${e().x}px`),L(m,"top",()=>`${e().y}px`),L(m,"min-width",()=>`${p().name().length+1}ch`),L(m,"width",()=>`${o()}ch`),k(m,"pattern",`^${De}+$`),v(m,"blur",c),v(m,"change",c),v(m,"input",_=>r(_.currentTarget.value.length+1)),ee.$$slots={default:()=>[(()=>{let _=rr(),F=_.firstChild.nextSibling,I=F.nextSibling,z=I.firstChild,tt=I.nextSibling;return w(F," "),w(z,()=>rt()[s()]?.name()),_})(),(()=>{let _=lr(),R=_.firstChild,I=R.firstChild.firstChild,z=R.nextSibling,H=z.firstChild.firstChild;return v(R,"click",h),v(z,"click",()=>u(!1)),_})()]},w(y,ee({get open(){return a()}},ee.$$slots)),ne.$$slots={header:()=>{let _=cr(),R=_.firstChild;return _},default:()=>[(()=>{let _=or(),R=_.firstChild;return _})()]},w(A,ne({get open(){return l()},get onChange(){return d},level:"error"},ne.$$slots)),ht.$$slots={default:()=>[(()=>{let _=sr(),F=_.firstChild.nextSibling;return w(F,()=>a()),_})()]},w($,ht({},ht.$$slots)),b})()}var ur=E("<i>\uF576</i>");function $e(){function t(e){if(ue(e),p().selectedRegions().size===0)return;let n=p().colorRegions()[e]??new Set;console.log(JSON.stringify([...n],null,2));for(let o of p().selectedRegions()){let r=U(o);gn(n,r.startCol,r.startRow,r.endCol,r.endRow)}p().setColorRegions.byRef(o=>{for(let r in o)if(r!==e)for(let s of n){let i=U(s);bn(o[r],i.startCol,i.startRow,i.endCol,i.endRow),o[r].size===0&&(delete o[r],delete p().colorQuads()[r])}e!==Ct()&&(o[e]=n,p().setColorQuads.byRef(r=>{let s=r[e]??[];s.length=0;for(let i of n)s.push(...ut(U(i)));r[e]=s}))})}return N(()=>[p().colorRegions(),p().colOffsets(),p().rowOffsets()],()=>{p().setColorQuads.byRef(e=>{for(let n in e){if(!p().colorRegions()[n]){delete e[n];continue}let o=e[n];o.length=0;for(let r of p().colorRegions()[n])o.push(...ut(U(r)))}})}),gt.$$slots={default:()=>[(()=>{let n=ur(),o=n.firstChild;return n})()]},gt({get defaultColor(){return Ct()},get color(){return Rn()},get onChange(){return t}},gt.$$slots)}var Hn="XLSX",Xn=3,fr=14,dr=2,mr=4,xr=4,pr=13,Vn=6,Yn=1,Qn=2,Kn=3,qn=4;function Zn(){let t={};for(let e of rt())t[e.name()]={regions:e.colorRegions(),texts:e.textCells(),rowOffsets:e.rowOffsets(),colOffsets:e.colOffsets()};return t}function Jn(t){let e=new TextEncoder,n=new Map,o=[];for(let{regions:d}of Object.values(t))for(let c of Object.keys(d))if(!n.has(c)){let[C,h,S]=Et(c).map(b=>Math.floor(b*256));n.set(c,o.length),o.push([C,h,S])}let r=[];for(let[d,{regions:c,texts:C,rowOffsets:h,colOffsets:S}]of Object.entries(t)){let b=e.encode(d),x=Object.entries(c).flatMap(([m,y])=>{let A=n.get(m);return Array.from(y).map($=>{let{startRow:_,startCol:R,endRow:F,endCol:I}=U($);return{cid:A,sr:_,sc:R,rs:F-_+1,cs:I-R+1}})}),j=Object.entries(C).map(([m,y])=>{let A=+m,$=e.encode(y.text),_=0;y.style.bold&&(_|=1),y.style.italic&&(_|=2),y.style.underline&&(_|=4),y.style.strikethrough&&(_|=8);let R=[],F=[];if(y.style.family!==zt){F.push(Yn);let I=e.encode(y.style.family);R.push(new Uint8Array([I.length,...I]))}if(y.style.size!==Wt&&(F.push(Qn),R.push(y.style.size)),y.style.color!==Vt){F.push(Kn);let I=e.encode(y.style.color);R.push(new Uint8Array([I.length,...I]))}if(y.style.format&&y.style.format!==""){F.push(qn);let I=e.encode(y.style.format);R.push(new Uint8Array([I.length,...I]))}return{idx:A,textBytes:$,flags:_,extras:R,extraIDs:F}}),g=Object.entries(h).map(([m,y])=>({i:+m,d:y})),f=Object.entries(S).map(([m,y])=>({i:+m,d:y}));r.push({nameBytes:b,regionBlocks:x,textBlocks:j,rowOff:g,colOff:f})}let s=fr+o.length*xr;for(let d of r){s+=dr+d.nameBytes.length,s+=mr*4,s+=d.regionBlocks.length*pr;for(let c of d.textBlocks){s+=6+c.textBytes.length+1+1;for(let C=0;C<c.extras.length;C++){let h=c.extras[C];s+=1,typeof h=="number"?s+=2:s+=h.byteLength}}s+=d.rowOff.length*Vn,s+=d.colOff.length*Vn}let i=new ArrayBuffer(s),a=new DataView(i),u=new Uint8Array(i),l=0;u.set([...Hn].map(d=>d.charCodeAt(0)),l),l+=4,a.setUint16(l,Xn,!0),l+=2,a.setUint32(l,r.length,!0),l+=4,a.setUint32(l,o.length,!0),l+=4,o.forEach((d,c)=>{a.setUint8(l++,c);for(let C of d)a.setUint8(l++,C)});for(let d of r){a.setUint16(l,d.nameBytes.length,!0),l+=2,u.set(d.nameBytes,l),l+=d.nameBytes.length,a.setUint32(l,d.regionBlocks.length,!0),l+=4,a.setUint32(l,d.textBlocks.length,!0),l+=4,a.setUint32(l,d.rowOff.length,!0),l+=4,a.setUint32(l,d.colOff.length,!0),l+=4;for(let c of d.regionBlocks)a.setUint8(l++,c.cid),a.setUint32(l,c.sr,!0),l+=4,a.setUint32(l,c.sc,!0),l+=4,a.setUint16(l,c.rs,!0),l+=2,a.setUint16(l,c.cs,!0),l+=2;for(let c of d.textBlocks){a.setUint32(l,c.idx,!0),l+=4,a.setUint16(l,c.textBytes.length,!0),l+=2,u.set(c.textBytes,l),l+=c.textBytes.length,a.setUint8(l,c.flags),l+=1,a.setUint8(l,c.extras.length),l+=1;for(let C=0;C<c.extras.length;C++){a.setUint8(l,c.extraIDs[C]),l+=1;let h=c.extras[C];typeof h=="number"?(a.setUint16(l,h,!0),l+=2):(u.set(h,l),l+=h.byteLength)}}for(let c of d.rowOff)a.setUint32(l,c.i,!0),l+=4,a.setInt16(l,c.d,!0),l+=2;for(let c of d.colOff)a.setUint32(l,c.i,!0),l+=4,a.setInt16(l,c.d,!0),l+=2}return new Uint8Array(i,0,l)}function to(t){let e=new TextDecoder,n=new DataView(t.buffer,t.byteOffset,t.byteLength),o=0;if(e.decode(t.subarray(o,o+4))!==Hn)throw new Error("Invalid XLSX_MAGIC");o+=4;let s=n.getUint16(o,!0);if(o+=2,s!==Xn)throw new Error("Unsupported XLSX_VERSION");let i=n.getUint32(o,!0);o+=4;let a=n.getUint32(o,!0);o+=4;let u=[];for(let d=0;d<a;d++){let c=n.getUint8(o++),C=n.getUint8(o++),h=n.getUint8(o++),S=n.getUint8(o++);u[c]=`#${[C,h,S].map(b=>b.toString(16).padStart(2,"0")).join("")}`}let l={};for(let d=0;d<i;d++){let c=n.getUint16(o,!0);o+=2;let C=e.decode(t.subarray(o,o+c));o+=c;let h=n.getUint32(o,!0);o+=4;let S=n.getUint32(o,!0);o+=4;let b=n.getUint32(o,!0);o+=4;let x=n.getUint32(o,!0);o+=4;let j={};for(let y=0;y<h;y++){let A=n.getUint8(o++),$=n.getUint32(o,!0);o+=4;let _=n.getUint32(o,!0);o+=4;let R=n.getUint16(o,!0);o+=2;let F=n.getUint16(o,!0);o+=2;let I=$+R-1,z=_+F-1,tt=`${_},${$}:${z},${I}`,H=u[A];j[H]||(j[H]=new Set),j[H].add(tt)}let g={};for(let y=0;y<S;y++){let A=n.getUint32(o,!0);o+=4;let $=n.getUint16(o,!0);o+=2;let _=e.decode(t.subarray(o,o+$));o+=$;let R=n.getUint8(o++),F=n.getUint8(o++),I={family:zt,size:Wt,color:Vt,bold:!!(R&1),italic:!!(R&2),underline:!!(R&4),strikethrough:!!(R&8),format:ie};for(let z=0;z<F;z++){let tt=n.getUint8(o++);if(tt===Yn){let H=n.getUint8(o++);I.family=e.decode(t.subarray(o,o+H)),o+=H}else if(tt===Qn)I.size=n.getUint16(o,!0),o+=2;else if(tt===Kn){let H=n.getUint8(o++);I.color=e.decode(t.subarray(o,o+H)),o+=H}else if(tt===qn){let H=n.getUint8(o++);I.format=e.decode(t.subarray(o,o+H)),o+=H}}g[A]={text:_,style:I,computed:""}}let f={};for(let y=0;y<b;y++){let A=n.getUint32(o,!0);o+=4;let $=n.getInt16(o,!0);o+=2,f[A]=$}let m={};for(let y=0;y<x;y++){let A=n.getUint32(o,!0);o+=4;let $=n.getInt16(o,!0);o+=2,m[A]=$}l[C]={regions:j,texts:g,rowOffsets:f,colOffsets:m}}return l}var hr=E('<header class="grid grid-cols-[auto_1fr_max-content] items-center gap-2 w-full p-2 bg-stone-300 text-zinc-900 dark:bg-zinc-950 dark:text-stone-100"><h1 class="text-black text-xl text-inherit font-bold px-3"><i>\uF0CE</i> Sheets</h1><section class="overflow-auto flex h-full gap-2 *:flex-none *:w-max scrollbar-hidden min-[1245px]:justify-end"><button data-icon type="button" class="rounded-square" title="Export">\uF56E</button><label data-button data-icon title="Import" class="rounded-square leading-[27px]">\uF56F<input type="file" class="hidden"/></label><div></div><!><!><div></div><button data-icon type="button" class="rounded-square" title="Clear selection">\uF1F8</button><button data-icon type="button" class="rounded-square" title="Column left">\uF0D9</button><button data-icon type="button" class="rounded-square" title="Column right">\uF0DA</button><button data-icon type="button" class="rounded-square" title="Row down">\uF0DD</button><button data-icon type="button" class="rounded-square" title="Row up">\uF0D8</button><div></div><button data-icon type="button" class="rounded-square" title="Debug Info">\uF121</button><div></div><button data-icon type="button" class="min-w-4 rounded-square"><!></button></section><button data-icon type="button" class="rounded-sm min-[1245px]:hidden!">\uF101</button></header>'),[oe,Re]=T(!1);function we(){let t;function e(s,i){let a=Jt(),u=(s?a.startRow:a.startCol)+i,l=s?c=>Math.floor(c/D):c=>c%D,d=s?c=>(Math.floor(c/D)+1)*D+c%D:c=>Math.floor(c/D)*D+(c%D+1);p().setTextCells.byRef(c=>{let C=Object.keys(c).map(Number).sort((h,S)=>S-h);for(let h of C)if(l(h)>=u){let S=d(h);c[S]=c[h],delete c[h]}for(let h of Object.keys(c)){let S=Number(h),{text:b,computed:x,style:j}=c[S];if(b.startsWith("=")){let g=new Dt(b.slice(1)).parseExpression(),f=qt(g,s,u);b=`=${Kt(f)}`,c[S]={text:b,computed:x,style:j}}}jt(c)})}function n(){p().setTextCells.byRef(s=>{me(s,(i,a)=>delete s[a]),jt(s)})}function o(){let s=Jn(Zn()),i=new Blob([s],{type:"application/octet-stream"}),a=URL.createObjectURL(i),u=document.createElement("a");u.href=a,u.download="spreadsheet",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(a)}function r(){let s=this.files?.[0];if(!s)return;let i=new FileReader;i.onload=()=>{if(!(i.result instanceof ArrayBuffer))return;let a=new Uint8Array(i.result),u=to(a);xe.byRef(l=>{l.length=0;for(let d in u){let c=de(d),C=u[d];c.setColOffsets(C.colOffsets),c.setRowOffsets(C.rowOffsets),c.setTextCells(C.texts),c.setColorRegions(C.regions),c.setColorQuads.byRef(h=>{for(let S in C.regions)if(S!==Ct()){let b=h[S]??[];b.length=0;for(let x of C.regions[S])b.push(...ut(U(x)));h[S]=b}}),jt(c.textCells()),l.push(c)}jt(l[0].textCells()),Nt(l[0])})},i.readAsArrayBuffer(s)}return(()=>{let s=hr(),i=s.firstChild,a=i.firstChild,u=a.firstChild,l=a.nextSibling,d=i.nextSibling,c=d.firstChild,C=c.firstChild,h=c.nextSibling,b=h.firstChild.nextSibling,x=h.nextSibling,j=x.nextSibling,g=j.nextSibling,f=g.nextSibling,m=f.nextSibling,y=m.firstChild,A=m.nextSibling,$=A.firstChild,_=A.nextSibling,R=_.firstChild,F=_.nextSibling,I=F.firstChild,z=F.nextSibling,tt=z.firstChild,H=z.nextSibling,Rt=H.nextSibling,re=Rt.firstChild,Qe=Rt.nextSibling,Ke=Qe.nextSibling,eo=Ke.firstChild,qe=d.nextSibling,$r=qe.firstChild;return t=d,v(c,"click",o),v(b,"change",r),k(x,"class",_t),ge.$$slots={},w(j,ge({})),$e.$$slots={},w(g,$e({})),k(f,"class",_t),v(m,"click",n),v(A,"click",()=>e(!1,0)),v(_,"click",()=>e(!1,1)),v(F,"click",()=>e(!0,1)),v(z,"click",()=>e(!0,0)),k(H,"class",_t),q(Rt,"selected",()=>oe()),v(Rt,"click",()=>Re(!oe())),k(Qe,"class",_t),v(Ke,"click",()=>An(!Z())),w(eo,()=>Z()?"\uF186":"\uF185"),v(qe,"click",()=>t.scrollTo({left:t.scrollWidth,behavior:"smooth"})),s})()}var gr=E('<div data-toasts class="absolute px-4 left-0 bottom-0 z-100 w-dvw h-0"></div>'),br=E('<div data-alerts class="absolute left-0 top-0 z-100 h-dvh w-dvw not-has-[[open=true]]:hidden bg-slate-950/50 backdrop-blur-xs"></div>'),_r=E('<main class="grid grid-rows-[auto_1fr_auto] w-full h-full select-none"><!><!><article class="font-mono overflow-hidden max-w-dvw max-h-dvh grid grid-rows-[auto_minmax(0,1fr)] grid-cols-[max-content_minmax(0,1fr)]"><!><!><!></article><!></main>');window._jsx$global_event_keydown=window._jsx$global_event_keydown||Q("keydown");window._jsx$global_event_keyup=window._jsx$global_event_keyup||Q("keyup");document.body.append((he.$$slots={},he({class:"min-w-sm",title:"Debug",id:"dbg",get open(){return oe()},x:100,y:100,draggable:!0,get onClose(){return Re}})),br(),gr());function Cr(t){t.key==="?"?Re(!oe()):t.key==="Control"&&!bt?Pe(!0):!bt&&t.key.toLowerCase()==="a"&&vt()&&p().setLastSelectedRegions.byRef(e=>{e.clear(),e.add(Yt({startCol:0,startRow:0,endCol:D,endRow:It}))})}function yr(t){t.key==="Control"&&!bt&&Pe(!1)}document.body.prepend((()=>{let t=_r(),e=t.firstChild,n=e.nextSibling,o=n.nextSibling,r=o.firstChild,s=r.nextSibling,i=s.nextSibling,a=o.nextSibling;return P(window._jsx$global_event_keydown,t,Cr),P(window._jsx$global_event_keyup,t,yr),we.$$slots={},w(e,we({})),Ce.$$slots={},w(n,Ce({})),_e.$$slots={},w(r,_e({})),be.$$slots={},w(s,be({})),pe.$$slots={},w(i,pe({})),ye.$$slots={},w(a,ye({})),t})());})();
//# sourceMappingURL=main.js.map
